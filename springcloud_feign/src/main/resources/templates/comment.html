<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">


    <title>Title</title>

    <script src="../jquery.min.js" ></script>
    <link rel="stylesheet" href="../layui-v2.4.5/layui/css/layui.css" media="all" />
    <script src="../layui-v2.4.5/layui/layui.js" ></script>
    <script>
        function fda(){
            layui.use(['rate'], function(){
                var rate = layui.rate;
                //显示文字
                rate.render({
                    elem: '.test1'
                    ,value: 1
                    ,readonly: true
                });
                rate.render({
                    elem: '.test2'
                    ,value: 2
                    ,readonly: true
                });
                rate.render({
                    elem: '.test3'
                    ,value: 3
                    ,readonly: true
                });
                rate.render({
                    elem: '.test4'
                    ,value: 4
                    ,readonly: true
                });
                rate.render({
                    elem: '.test5'
                    ,value: 5
                    ,readonly: true
                });
            });
        }


    </script>

    <script type="text/javascript">
        function timer(opj){
            $(opj).find('ul').animate({
                marginTop : "-3.5rem"
            },500,function(){
                $(this).css({marginTop : "0.7rem"}).find("li:first").appendTo(this);
            })
        }
        $(function(){
            var num = $('.notice_active').find('li').length;
            if(num > 1){
                var time=setInterval('timer(".notice_active")',3500);
                $('.gg_more a').mousemove(function(){
                    clearInterval(time);
                }).mouseout(function(){
                    time = setInterval('timer(".notice_active")',3500);
                });
            }

            $(".news_ck").click(function(){
                location.href = $(".notice_active .notice_active_ch").children(":input").val();
            })
        });
    </script>




    <style type="text/css">
        /*border-bottom: 1px solid #F0F0F0;*/
        .huadong {width: 60rem;height:4rem;padding: 0.5rem 0 0.3rem 0; border-bottom: 1px solid #F0F0F0; position:relative;font: 12px/1.5 "Hiragino Sans GB","Microsoft YaHei",simsun;margin:0 auto;}
        .huadong .huabox {  margin:0 auto; width: 80%; line-height: 4rem;}
        .huadong .hdimg {float:left;line-height:3.5rem;}
        .huadong .hdimg img { width: 100%; vertical-align:middle;}
        .huadong h5 {font-size:1rem;float:left; line-height: 2.2rem; margin: 0.8rem 0 0 0; }
        .huadong .gg_more { float: left;}
        .huadong .gg_more a { font-size: 0.8rem; text-decoration:none;}

        .huadong .notice_active {
            float: left;
            width: 55%;
            height: 4rem;
            padding: 0;
            overflow: hidden;
            position: relative;
        }
        .huadong .notice_active li{list-style-type:none;line-height: 2.4rem;overflow: hidden;}
        /*.huadong .notice_active li.notice_active_ch {}*/
        .huadong .notice_active li.notice_active_ch span {color:#656972;font-size:1rem;display: block;overflow: hidden; width:80%;float: left;
            overflow: hidden;margin:0 0 2rem 0;}
        .huadong .gg_more .news_ck {
            float: left;
            margin: 0 1rem 0 1rem;
            color: #888;
            width: 5rem;
            height: 2rem;
            line-height: 2rem;
            display: block;
            border: 1px solid #656972;
            text-align: center;
            border-radius: 0.7rem;
            font-size: 0.8rem;
            margin-top: 1rem;
        }
        .huadong .gg_more .news_more {

        }
        .huadong .notice_active li.notice_active_ch em {text-align:right;float:right;color:#888;font-size:0.8rem;font-style:normal;  }
    </style>


</head>
<body>
    <ul class="layui-nav">
        <li class="layui-nav-item"><a href="">饿了吗欢迎您的评论</a></li>
        <li class="layui-nav-item layui-this">
            <a href="javascript:;">产品</a>
            <dl class="layui-nav-child">
                <dd><a href="">选项1</a></dd>
                <dd><a href="">选项2</a></dd>
                <dd><a href="">选项3</a></dd>
            </dl>
        </li>
        <li class="layui-nav-item"><a href="">大数据</a></li>
        <li class="layui-nav-item">
            <a href="javascript:;">促销打折</a>
            <dl class="layui-nav-child">
                <dd><a href="">移动模块</a></dd>
                <dd><a href="">后台模版</a></dd>
                <dd class="layui-this"><a href=""></a></dd>
                <dd><a href=""></a></dd>
            </dl>
        </li>
        <li class="layui-nav-item"><a href=""></a></li>
    </ul>

    <div class="qm-position">
        <span class="layui-breadcrumb" lay-separator="/" style="margin-left:50px">
            <a href="/">首页</a>
            <a title="用户评论" href="list-37.htm">用户评论</a>
        </span>
    </div>
    <main>
        <div class="h5_yellow"></div>
        <div class="qm-mainbox">
            <div class="qm-maincont">
                <div class="qm-Icontitle">
                    <div class="qm-icon"><img src="../layui-master/dist/images/face/2.gif" height="22" width="22"/></div>
                    <div class="qm-t1">
                        <h1>用户评价</h1>
                        <h3>EVALUATE</h3>
                    </div>
                </div>
                <ul class="layui-nav layui-bg-blue">
                    <li class="layui-nav-item"><a href="">艳蓝导航</a></li>
                    <li class="layui-nav-item layui-this"><a href="">产品</a></li>
                    <li class="layui-nav-item"><a href="">大数据</a></li>
                    <li class="layui-nav-item">
                        <a href="javascript:;">解决方案</a>
                        <dl class="layui-nav-child">
                            <dd><a href="">移动模块</a></dd>
                            <dd><a href="">后台模版</a></dd>
                            <dd><a href="">电商平台</a></dd>
                        </dl>
                    </li>
                    <li class="layui-nav-item"><a href="">社区</a></li>
                </ul>
            </div>
            <div class="site-demo-button" id="layerDemo" style="margin-bottom: 0;">
                <button data-method="notice" class="layui-btn">示范一个公告层</button>
            </div>

            <div class="huadong">
                <div class="huabox">
                    <div class="hdimg">
                        <i class="layui-icon layui-icon-speaker" style="width: 20px"></i>
                    </div>
                    <h5>【公告】</h5>
                    <div class="notice_active">
                        <ul>
                            <li class="notice_active_ch">
                                <span>欢迎下次光临</span>

                                <em>2017-01-20</em>
                            </li>
                            <li class="notice_active_ch">
                                <span>请为本次服务进行评价</span>

                                <em>2017-01-20</em>
                            </li>
                            <li class="notice_active_ch">
                                <span>五星好评有奖励哦</span>

                                <em>2017-01-20</em>
                            </li>

                        </ul>

                    </div>

                    <div class="gg_more">
                        <a class="news_ck" href="javascript:void(0)">查看详情</a>
                        <a title="news_more" href="#">更多+</a>
                    </div>
                </div>
            </div>


            <div class="layui-row" id="comment_list"></div>
                        <div class="layui-row layui-col-space10" >
                            <div class="layui-col-md2"></div>
                            <div class="layui-col-md3">
                                <a href="javaScript:toPage(1)">首页</a>
                                <a href="javaScript:toPage(2)">上一页</a>
                                <a href="javaScript:toPage(3)">下一页</a>
                                <a href="javaScript:toPage(4)">尾页</a>
                                <input type="hidden" id="currentPageId"/>
                                <input type="hidden" id="pageSizeId">
                                <input type="hidden" id="totalPageId"/>
                            </div>
                        </div>
                         <div id="test1"></div>
                        <input type="hidden" id="testCype"/>
                        <button type="button" id="u">评分</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
    <form class="layui-form" action="">
        <div class="layui-form-item">

            <div class="layui-form-item layui-form-text">

                <div class="layui-input-block">
                    <textarea placeholder="请输入内容" class="layui-textarea" id="desc"></textarea>
                </div>
            </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-input-block">
                    <button  type="button" class="layui-btn" id="cBtn" lay-filter="demo1">发表评论</button>
                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                </div>
            </div>
    </form>


</body>
<script type="text/javascript">
    function toPage(flag){
        //获取当前页对象
        var currentPageObj = $("#currentPageId");
        //获取每页显示条数对象
        var pageSizeObj = $("#pageSizeId");
        //获取总页数
        var totalPage = $("#totalPageId").val();

        if(flag==0){
            debugger;
            pageSizeObj.val($('#pageSize_select').val());
        }
        if(flag==1){
            if(currentPageObj.val()==1){
                alert("当前已为首页！！！");
                return ;
            }
            currentPageObj.val(1);
        }
        if(flag==2){
            if(currentPageObj.val()==1){
                alert("当前已为第一页！！！");
                return ;
            }
            currentPageObj.val(Number(currentPageObj.val())-1);
        }
        if(flag==3){
            if(currentPageObj.val()==totalPage){
                alert("当前已为最后一页！！！");
                return ;
            }
            currentPageObj.val(Number(currentPageObj.val())+1);
        }
        if(flag==4){
            if(currentPageObj.val()==totalPage){
                alert("当前已为尾页！！！");
                return ;
            }
            currentPageObj.val(totalPage);
        }
        //通过表单的id 获取对应表单对象进行 表单提交
        querycomment(currentPageObj.val(),pageSizeObj.val());
    }
</script>
<script th:inline="none">

    //初始化加载页面
    $(function(){
        querycomment(1,3);
        replaceSensitive();
    })


    //初始化查询评论 评分
    function querycomment(page,limit){
        $.ajax({
            url:'http://localhost:8082/queryComment',
            type:'post',
            data:{
                'page':page,
                'limit':limit
            },
            dataType:'json',
            success:function(data){
                var page1 = data.pageUtil;
                var list = data.list;
                $('#currentPageId').val(page1.currentPage);
                $('#pageSizeId').val(page1.pageSize);
                $('#totalPageId').val(page1.totalPage);
                var html = innhtml(list);
                $('#comment_list').html(html);
                fda();
            },
            error:function(){
                alert("1111")
            }
        })
    }
    //拼接展示页面格式
    function innhtml(list){
        var html = $('comment_list').html();
        if(html == undefined){
            html = '';
        }
        for(var i in list){
            html += '<div class="layui-row layui-col-space10" ><div class="layui-col-md1"></div><div class="layui-col-md9"><div class="layui-row"><div class="layui-col-md2">';
            html += list[i].commentname+'</div><div class="layui-col-md10">';
            switch(list[i].grade)
            {
                case 1:
                    html += '<div class="test1"></div><div>';
                    break;
                case 2:
                    html += '<div class="test2"></div><div>';
                    break;
                case 3:
                    html += '<div class="test3"></div><div>';
                    break;
                case 4:
                    html += '<div class="test4"></div><div>';
                    break;
                case 5:
                    html += '<div class="test5"></div><div>';
                    break;
            }
            html += list[i].comment;
            html += '</div></div></div><div class="layui-row"><div class="layui-col-md2"></div><div class="layui-col-md10"><div class="layui-layout-left">';
            html += list[i].commentdate;
            html += '</div></div></div></div></div><div class="layui-row layui-col-space10"><div class="layui-col-md1"></div><div class="layui-col-md9"><fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;"></fieldset></div></div>';


        }
        return html;
    }

    layui.use('carousel', function () {
        var carousel = layui.carousel;
        //建造实例
        carousel.render({
            elem: '#qm-index'
            , width: '1440px' //设置容器宽度
            , height: '461px'
            , arrow: 'hover' //始终显示箭头
            //,anim: 'updown' //切换动画方式
        });
    });

    //新增评论评分
    layui.use('element', function(){
        var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
        //监听导航点击
        element.on('nav(demo)', function(elem){
            layer.msg(elem.text());
        });
    });
    $("#cBtn").click(function () {
        var tsetCype=$("#testCype").val();
        var desc=$("#desc").val();
        alert(tsetCype)
        $.ajax({
            url:'http://localhost:8082/saveComment',
            type:'post',
            data:{
                'grade':tsetCype,
                'comment':desc
            },
            dataType:'json',
            success:function(){
                querycomment(1,3);
            }

        })

    })

    layui.use('rate', function(){
        var rate = layui.rate;
        //显示文字
        rate.render({
            elem: '#test1'
            ,value: 0 //初始值
            ,text: true //开启文本
            ,setText: function(value) {
                $("#testCype").val(value);
            }
        });

    });


</script>
<script type="text/javascript">
    function replaceSensitive(){


    window.onload=function(){
        var desc=document.getElementById('desc');
        var re=/打架|你大爷|喝茶|贪污|腐败|专制|黑暗|打黑/g;
        $('#desc').bind('input',function(){
            var result=$('#desc').val().replace(re,'**');
            $('#desc').val(result);
        })
      }
    }
</script>
</html>